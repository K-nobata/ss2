<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steam 日本語レビュー高評価ランキング</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffffff;
  color: #111827;
  margin: 0;
  padding: 24px;
}

h1 {
  margin-bottom: 12px;
  font-size: 24px;
}

/* ===== フィルタUI ===== */
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

.controls select,
.controls input {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #d1d5db;
}

.controls button {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #d1d5db;
  background: #f9fafb;
  cursor: pointer;
}

/* ===== テーブル ===== */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px;
  font-size: 14px;
  border-bottom: 1px solid #e5e7eb;
  text-align: center;
}

th {
  background: #f3f4f6;
  font-weight: 600;
}

td.game {
  text-align: left;
}

/* ===== ジャンルタグ ===== */
.genre-tag {
  display: inline-block;
  font-size: 12px;
  padding: 3px 8px;
  background: #e5e7eb;
  border-radius: 999px;
  margin: 6px 6px 0 0;
}

/* ===== JP優位ハイライト ===== */
.jp-better {
  background: #ecfdf5;
}

/* ===== JPバッジ ===== */
.jp-badge {
  font-size: 12px;
  padding: 2px 6px;
  margin-left: 6px;
  border-radius: 6px;
  background: #16a34a;
  color: white;
}

a {
  color: inherit;
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}
</style>
</head>

<body>
<h1>STEAM 日本語レビュー高評価ランキング</h1>

<div class="controls">
  <select id="genreFilter">
    <option value="">ジャンル（すべて）</option>
  </select>

  <input id="yearFrom" type="number" placeholder="発売年 From" />
  <input id="yearTo" type="number" placeholder="発売年 To" />

  <input id="minReviews" type="number" placeholder="日本語レビュー数 ≥" />

  <button onclick="applyFilter()">絞り込み</button>
  <button onclick="resetFilter()">リセット</button>
</div>

<table>
<thead>
<tr>
  <th>順位</th>
  <th>ゲーム</th>
  <th>日本語評価率</th>
  <th>日本語レビュー数</th>
  <th>全言語評価率</th>
  <th>全言語レビュー数</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
let allGames = [];

function getYear(dateStr) {
  if (!dateStr) return null;
  const m = dateStr.match(/^(\d{4})/);
  return m ? Number(m[1]) : null;
}

function buildGenreFilter() {
  const set = new Set();
  allGames.forEach(g => (g.genres || []).forEach(t => set.add(t)));
  const sel = document.getElementById("genreFilter");
  [...set].sort().forEach(t => {
    const o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    sel.appendChild(o);
  });
}

function render(games) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  games.forEach((g, i) => {
    const jpBetter = g.positive_rate_jp > g.positive_rate_all;
    const diff = jpBetter
      ? "+" + (g.positive_rate_jp - g.positive_rate_all).toFixed(1) + "%"
      : "";

    tbody.innerHTML += `
      <tr class="${jpBetter ? "jp-better" : ""}">
        <td>${i + 1}</td>
        <td class="game">
          <a href="${g.store_url}" target="_blank">
            ${g.name} (${getYear(g.release_date)})
          </a>
          ${jpBetter ? `<span class="jp-badge">JP ${diff}</span>` : ""}
          <div>
            ${(g.genres || []).map(t => `<span class="genre-tag">${t}</span>`).join("")}
          </div>
        </td>
        <td>${g.positive_rate_jp}%</td>
        <td>${g.total_reviews_jp}</td>
        <td>${g.positive_rate_all}%</td>
        <td>${g.total_reviews_all}</td>
      </tr>
    `;
  });
}

function applyFilter() {
  const genre = document.getElementById("genreFilter").value;
  const yFrom = Number(document.getElementById("yearFrom").value);
  const yTo = Number(document.getElementById("yearTo").value);
  const minRev = Number(document.getElementById("minReviews").value);

  const filtered = allGames.filter(g => {
    const y = getYear(g.release_date);
    if (genre && !(g.genres || []).includes(genre)) return false;
    if (yFrom && (!y || y < yFrom)) return false;
    if (yTo && (!y || y > yTo)) return false;
    if (minRev && g.total_reviews_jp < minRev) return false;
    return true;
  });

  render(filtered);
}

function resetFilter() {
  document.querySelectorAll(".controls input").forEach(i => i.value = "");
  document.getElementById("genreFilter").value = "";
  render(allGames);
}

async function load() {
  const res = await fetch("data.json");
  allGames = await res.json();
  allGames.sort((a, b) => b.positive_rate_jp - a.positive_rate_jp);
  buildGenreFilter();
  render(allGames);
}

load();
</script>
</body>
</html>
